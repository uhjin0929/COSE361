---
tags: 시험은주관식서술형, TCP, UDP
---
# Transport Layer Services
- **4계층의 키워드 : logical communication**
	- 논리적으로 data를 처음 보내는 출발지, 최종 목적지까지 transport 계층이 관여한다.
	- infrastructure의 세부사항의 관계 없이 같은 계층 간 논리적 소통이 가능토록 한다.
	- 물리적 communication이 2계층.. (3 : )
	- 인터넷 애플리케이션을 위한 UDP, TCP
---
- **Transport vs Network**
	- network : logical communication, between **hosts**
	- transport : logical communication, between **processes**
	- 비유 : 집을 호스트,집의 아이들이 프로세스, 우리가 전송하고자 하는 data(app msg)가 편지..
---
- 물리적으로 떨어진 단말기들의 통신이 네트워크가 아니고, 논리적으로 이루어지는 계층 간의 데이터 전송도 네트워크라고 할 수 있다.

- **TCP(신뢰성 by 3way Handshake)**
	- 혼잡 제어, 흐름 제어, connection setup(handshake)
- **UDP(신뢰성 X, no handshake)**
	- best-effort : 데이터가 가다가 유실되거나 변질될 수 있다.

# Multiplexing and demultiplexing

- 서버 입장에서는 **1:多 통신**을 하고 있지..
	- 하나의 서버 프로세스에 여러개의 클라이언트가 붙을 수가 있다.
- **Multiplexing** 
	- 보내는 쪽에서 데이터를 전송할 때, App lay에서 데이터가 내려오면 4계층에서 헤더를 붙이고 3계층쪽으로 내려주는 거 (캡슐화)
	- 프로세스는 편의상 프로그램으로 생각, 데이터가 왔다갔다하는 소켓
- **Demultiplexing : 데이터를 전송하는 것(통신을 하는 거다)**
	- 패킷은 header와 payload로 이루어져 있는데,
	- header에는 IP정보, 포트 정보가 들어감. 각각 두개씩 src와 dest.
	- 포트정보는 4계층에서 처리, 리시버(서버)는 패킷의 src/dest를 바꿔서 보냄.
	- TCP는 demultiplexing(통신을 할 때) 중 2x2=4가지 요소가 모두 사용. UDP는 dest 포트, dest IP만 사용.
	- TCP는 h/s하고 데이터를 전송하니 1:1 통신
	- UDP는 src는 없고 dest만 있는데, 다른 src들이 같은 dest로 보내니 1:多 통신을 할 수 있음.
	- TCP 소켓은 src/dest ip, src/dest port number을 다 사용

# UDP(User Datagram Protocol)

- 속도가 빠르다(시간이 중요하면 UDP로 구현하는 경우가 많음)
- 스트리밍, DNS(내 PC에서 DNS 서버한테 쿼리를 날릴 때 UDP를 씀), SNMP(네트워크에서 모니터링하기위한 정보 수집), HTTP/3 (일부 웹)
- segment[[Ch1. Introduction]] : 길다란 패킷을 하나하나 쪼갠 단위 하나
	- UDP segment의 헤더에는 source port, dest port, length, checksum, payload가 있음
	- checksum : 세그먼트 전송 시 에러 감지, UDP도 TCP에 비해 적긴 하지만, 검증을 하긴 한다, 코스트가 적은 에러검증 방법임

# 데이터를 안전하게 전송하는 방법

- **rdt(reliable data transfer)** : 데이터를 전송하고 나면, 잘 도착했는지 보낸 쪽에서도 잘 알기 위해 사용하는 프로토콜
	- 알아둘거 : rdt는 piplelining 프로토콜을 사용한다.
		- stop and wait operation : 내가 보내면, 확인 오고, 내가 보내면, 확인 오고...
- **Go- Back-N**
	- 내가 다섯개를 보낼 테니, 너가 다섯개를 받을 버퍼를 잘 만들어서 준비를 해놔!! (Handshake 과정에 있음)
	- loss된 패킷에 대해서는 응답이 없음, 이런건 전송을 다시 해야 하는 문제점
- **Selective repeat** : 패킷 여러개중 하나만 loss되면 이것만 다시 보내면 됨 
- 고백엔이든, SR이든 윈도우 사이즈에 맞춰서 넘어가는 것을 유심히 보자!!

# TCP

- 호스트 A가 B에게 데이터를 보낸다 (강의록80p)
- 86p, 응답이 안 온다고 해도 무한정 기다릴 순 없으니 timeout 시간(사전에 설정되는게 아니고, RTT를 이용해 계산할듯) 만큼 기다리고, 다시 전송한다.
- 첫 시작의 sequence 넘버는 랜덤, byte만큼 더해서 ACK, 그다음 sequence 넘버도 ACK.
	**## flow control** (내부의 계층별로 데이터를 올려보내는 과정에서)
	- 쪼개진 패킷이 하나하나 1계층부터 2,3,4..올라오는데
		- 각각의 패킷들의 헤더를 제거하고 위로 올려보내는 과정에서
		- 패킷이 여러개가 한꺼번에 올라오게 될 때
		- 버퍼라고 하는 메모리가 커버를 못 하면, overflow가 됨
		- 그 overflow가 안 나게 하기 위해서, flow control을 한다.
		- 계층별로 정해진 버퍼만큼 전송되게끔...
		- **즉, 수신 처리 속도에 송신 처리 속도를 맞춰야겠지요..... (윈도우 사이즈를 조절해서!!!!)**
	- TCP 헤더에 플래그(SYN,ACK) 
		- 3-way handshake (p101-103)
			- ACK는 무조건 보내는 쪽에서 첨 보낸 Seq 넘버에다가 SYNbit 사이즈를 더해서 답장함.

# Topology

1. icon들의 의미(스위치, 라우터, 서버, PC) 알아둘 것
2. 라우터 하위에 스위치, 스위치(가정에서는 무선AP) 하위에는 단말기
- 네트워크의 범위 = 패킷이 전달되는 범위
- **네모칸 : 하나의 네트워크 단위 aka 브로드캐스트 도메인, 로컬 영역(LAN)** : 이 쪽 안에 있는 PC에서 패킷을 전송하면 ===브로드캐스트 도메인 영역=== 내의 모든 놈===(패킷이 도달할수 있는 범위)=== 한테 다 전송됨. 단, 라우터를 넘어가진 못함, Wireshark에서 보면 src는 이상하게 나오고 dest는 broadcast로 찍힘(ip로 표현하면 255.255.255) 기준은 **라우터**
	- Q) 브로드캐스트 도메인이 몇개냐?(네트워크를 몇개로 쪼갤 수가 있냐?) A : 어떤 라우트를 기준으로, 라우터의 인터페이스 개수. (기준 라우터에서 다른 것으로 연결된 선의 수),
	- 브로드캐스트 도메인 위에 IP 정보 XXX.XXX.**10.0**/24 뜻 : **10.1~10.254까지의 ip를 다 사용**, 24는 서브넷 마스크
	- 보통 게이트웨이 주소를 1번 아니면 254번 줌
- **콜리전 도메인(충돌 도메인)** : 기준은 **스위치**
	- **스위칭** : PC1번에서 보낸 패킷이 스위치를 타고 PC3으로 전달된다. 이 때, PC2번은 PC1->PC3 패킷을 볼 수 없음 ,즉 PC2한테는 전달 안됨.
	- 여기서, PCn - S/W 사이의 포트 하나하나가 콜리전 도메인이다.
	- 허브는 자기 하위에 모든 놈한테 목적지 구분없이 다 뿌려버림.(브로드캐스트 도메인 만들어주는 역할)
		- 그렇기 때문에 충돌이 발생할 수 있음(PC4랑 PC5가 동시에 허브한테 쏜다고 생각해봐)
		- 근데 스위치가 있으면 **포워딩**때문에 충돌 안생김. 그치만 포트 하나하나가 충돌도메인..
	- 충돌 도메인의 개수? : 스위치의 포트의 개수!
	- CSMA/CD 방식 : 
		1. 동일한 네트워크에서 패킷을 보내고 싶은 A가 있다.
		2. A는 B에게 패킷을 보내기 위하여 네트워크상에 패킷이 돌아다니는게있는지확인
		3. 돌아다니는게 있다면 없어질 때까지 기다리고, 없어지면 그제서야 보냄
		4. A가 보낼 때 동시에 C도 패킷을 보내면 충돌
		5. 이것을 collision이라고 하며, 이런 충돌이 발생 가능한 범위를 콜리전 도메인이라고 함
	===**네트워크 그림을 보면, 브로드캐스트 도메인과 콜리전 도메인 개수를 구할 수 있도록 연습하자**===

- **같은 네트워크끼리 통신(라우터를 넘어가진 못함, 스위치가 일함) : MAC 어드레스로 통신**
	- 유니캐스트, 브로드캐스트(데스티네이션이 브로드캐스트면 스위치가 받아서 다 쏴버림
	- 멀티캐스트(유니와 브로드 중간) : 특정 집단에만 다 쏴버림
- **다른 네트워크끼리 통신 (다른 라우터, 라우터는 3계층 장비) 즉.. IP로 통신한다**
- **서브네팅** : 네트워크를 더 쪼개는 것 , ip가 각 나라별로 할당되어있는데 ip주소가 모자라게 되어 (서브넷 마스크를 사용해서) 하나의 ip주소 안에서 더 쪼개서 사용, 개념 정도만 알아둬