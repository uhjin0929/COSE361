- data plane : 포워딩, control plane : 라우팅 (라우터 안에서 어떤 일이??)
-  Data plane과 Control plane이 상호작용하는 구조이다.
- Transport, Application 계층과는 달리, 각 호스트와 네트워크의 라우터마다 Network 계층의 일부가 존재
- Network 계층의 근본적 역할 : **송신 호스트에서 수신호스트로 패킷 전달**
	- **포워딩(전달)** : 패킷이 라우터의 입력 링크에 도착하면, 적절한 출력 링크로 이동시킨다. **Data Plane** 에서, 걸리는 시간 매우 짧음.
		- 라우터 內에서 패킷을 보내는 
		- 여행 중에 교차로를 만나면, 교차로에서 어느 도로로 갈지 정하는 것!
	- **라우팅** : 송신자가 수신자에게 패킷을 보낼 때, 패킷의 경로를 결정한다. **Control Plane** 에서, 비교적 시간 김.
		- 경로를 계산하는 알고리즘을 **라우팅 알고리즘**이라고 한다.
		- 여행 경로를 계획하는 것!
- 포워딩 테이블
	- 네트워크 라우터에서 필수적 요소
	- 라우터가 도착하는 패킷 헤더의 필드값 조사 후, 패킷을 전달
	- 포워딩 테이블의 내부 인덱스 : 패킷 헤더의 필드값
	- 포워딩 테이블 엔트리에 있는 헤더값 : 해당 패킷이 전달되어야 할 라우터의 외부 링크 인터페이스
		- 라우터는 자신의 포워딩 테이블을 보고 패킷에 대한 출력 링크 인터페이스를 결정
- Control Plane의 전통적 접근 방법
	- 첫 포워딩 테이블을 구성
		- 라우팅 알고리즘으로 포워딩 테이블의 내용 결정
		- 한 라우터의 라우팅 알고리즘이 다른 라우터의 라우팅 알고리즘과 소통하며 포워딩 테이블의 값을 계산
		- 라우팅 프로토콜에 따라 라우팅 정보에 포함된 라우팅 메시지를 교환하며 이루어짐.
## 네트워크 서비스 모델
- 송/수신 호스트 간 패킷 전송 특성을 정의
- "best effort" servicce model
	- 패킷이 목적지까지 성공적으로 전송되는 걸 보장X
	- 송신된 순서대로 도착하는 것 보장 X
	- 지연 제한 이내에 전달되는 것 보장 X
	- 최소 대역폭 보장X

## 라우터의 구조
- 입력 포트
	- 입력 포트 큐잉 : 패킷이 포워딩 레이트보다 빨리 switch fabric에 전송되면 발생
- 목적지 기반 포워딩
	- 최종 목적지만을 검색하고, 최종 목적지로 연결되는 곳을 정한 후 그곳을 알려줌
	- dest의 IP 주소에만 기반해서 포워드함
- 일반화된 포워딩
	- 포워딩이 header의 필드값의 집합에 기반해서 일어남
- Longest prefix matching
	- 포워딩 테이블 엔트리에서 dest 주소를 찾을 때, dest 주소와 매칭되는 가장 기다란 address prefix를 사용한다!

## Switching
- 패킷을 input link에서 적절한 output link로 전송함
- 패킷이 입력 포트에서 출력 포트로 실제로 스위칭(포워딩)됨
- Switching via memory
	- 가장 단순한 초기의 라우터 : CPU를 직접 제어해서 입력 포트와 출력 포트 사이에서 패킷을 스위칭
- Switching via bus
	- 입력 포트 : 라우팅 프로세서의 개입 없이 공유 버스를 통해 직접 출력
- Switching via interconnection network
	- 크로스바 스위치 : N개의 입력 포트를 N개의 출력 포트에 연결
		- 2N개의 버스로 구성된 상호연결 네트워크
		- 여러 패킷을 병렬로 동시에 전달 가능

## Input Port Queuing
 - switch fabric이 input port보다 느림 -> 큐잉이 input queue에서 발생
## Output Port Queuing
- 들어오는 패킷을 저장할 메모리가 충분하지 않을때 도착한 패킷을 삭제하거나 이미 대기중인 패ㅣ킷을 제거하여 공간을 확보함

## Packet Scheduling
 - 어떤 패킷을 다음에 보낼지 결정
 - FCFS(FIFO) : 선입선출
 - 우선순위 큐잉 : 우선순위가 높은 큐에서 온 패킷을 먼저 보냄
 - 라운드 로빈(RR) : 클래스 간에 한번씩 돌아가면서, 번갈아 보냄.
## IP : the Internet Protocol
- IP Datagram : Network 계층의 패킷
- IP주소 : 각각의 호스트와 라우터 인터페이스와 연관된 32비트 식별자
- 인터페이스 : 호스트/ 라우터와 물리적 링크 사이의 연결
- IP가 192.168.10.5고 서브넷이 255.255.255.0이라고 하자
	- 그러면 255.255.255 -> 1이 24개니까, 192.168.10까지는 다 같은 네트워크
- 서브넷 : 각각 고립된 네트워크의 영역. 서브넷은 /24 이런식으로도 표기함
- CIDR : classless interdomain routing : 서브넷이 지멋대로 길이임 막 23 이런것도됨

## DHCP : IP를 할당해주는 서버
- 호스트가 IP주소를 자동으로 얻도록 하는 프로토콜
- 호스트 IP주소 할당뿐만 아니라, 서브넷 마스크, 첫번째 홉 라우터(디폴트 게이트웨이) 주소, 로컬 DNS 서버 주소도 알려줌
- 4단계 과정
	1. DHCP 서버 발견: 새롭게 도착한 호스트가 상호작용할 DHCP 발견하고 발견 메시지를 서버에게 보냄냄
	2. DHCP 서버 제공 : DHCP 서버가 DHCP 발견 메시지를 받으면 DHCP 제공메시지를 클라이언트로 응답
	3. DHCP 요청 : 새롭게 도착한 클라이언트는 하나 이상의 서버 제공자 중에 선택해서 DHCP 요청 메시지 응답
	4. DHCP ACK : 서버가 DHCP 요청 메시지에 대해 ACK 메세지로 응답

## NAT : 네트워크 주소 변환

- IP 패킷에 적힌 소켓 주소의 포트 숫자와 소스 및 목적지의 IP 주소 등을 재기록하면서 라우터를 통해 네트워크 트래픽을 주고 받는 기술
- 홈 네트워크 내부 장비는 /24 주소체계로 서로 패킷 송신 가능
- 그러나 글로벌 네트워크로 가는 패킷 전달은 이런 주소 사용 못함
- 글로벌 인터넷과의 송수신에서 NAT가 중요한 이유!

## IPv6

- 패킷의 구조가 더 간결하고 간소화됨 (존재하지 않는 필드가 있음)
- IPv6과의 차이점
	1. 확장된 주소 기능 : 32->128비트 확장 ,고갈걱정 없음
		- 새로운 주소 형태인 애니캐스트 주소
	2. 간소화된 헤더 : 많은 필드가 생략되거나 옵션으로 남겨짐, 라우터가 패킷을 더 빨리 처리함
		
- 포맷
	- 버전 : 4비트 필드로 IP버전 번호 인식 : 필드값은 6
	- 트래픽 클래스 : 8비트 필드로 패킷에 우선순위 부여
	- 흐름 레이블 : 20비트 필드로 패킷의 흐름 인식
	- 페이로드 길이 : 16비트 필드로 부호없는 정수
	- 다음 헤더 : 패킷의 내용이 전달될 프로토콜(TCP?UDP?)를 구분
	- 홉 제한 : 라우터가 패킷을 전달할 때마다 1씩 감소, 음수가 되면 패킷 버림
	- src/dest 주소
	- 데이터 : 페이로드 부분

## 일반화된 포워딩 및 소프트웨어 기반 네트워크(SDN)

- 두 단계의 목적지 기반 포워딩
	- 매치 :목적지 IP 주소 찾기
	- 액션:패킷을 스위치 구조로 지정된 출력 포트로 전송
- 소프트웨어 기반 네트워크(SDN)
	- 네트워크 환경이 변화하고 트래픽이 데이터 센터를 중심으로 전환되는 트래픽 패턴의 변화
	- 가상머신의 보편화
	- 네트워크 관리 필요
	- SDN 방법 : 라우터의 control plane과 data plane을 분리하고, 개방형 인터페이스를 외부에 제공
		- 매치(데이터흐름제어)와 액션(패킷전달)의 역할 분리
		- 네트워크 장비가 있는 인프라 계층에선 단순히 패킷 전달
		- 원격 컨트롤러(소프트웨어 제어기)에서 프로그래밍에서 데이터 흐름제어
- OpenFlow : 일반화된 포워딩에 대한 논의의 표준
	- 엔트리 : 테이블의 행
	- 일반화된 포워딩은 컨트롤 플레인에 의해 생성되는 포워딩 테이블을 참고하여 패킷을 전달

## 미들박스

- 데이터 경로에 위치해서 전달 외 추가 기능을 수행하는 다른 컴퓨터 네트워크 장치
- 미들박스가 수행하는 서비스
	- 1. NAT 변환
	- 2. 보안 서비스
	- 3. 성능 향상(압축)